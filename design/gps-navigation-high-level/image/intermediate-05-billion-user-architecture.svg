<svg xmlns="http://www.w3.org/2000/svg" width="2300" height="1380" viewBox="0 0 2300 1380">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#334155" />
    </marker>
    <style>
      .title { font: 700 30px Arial, Helvetica, sans-serif; fill: #0f172a; }
      .svc { fill: #e0ecff; stroke: #1d4ed8; stroke-width: 2.2; rx: 14; ry: 14; }
      .db { fill: #ecfeff; stroke: #0f766e; stroke-width: 2.2; rx: 14; ry: 14; }
      .bus { fill: #f0fdf4; stroke: #15803d; stroke-width: 2.2; rx: 14; ry: 14; }
      .ext { fill: #fff7ed; stroke: #c2410c; stroke-width: 2.2; rx: 14; ry: 14; }
      .ops { fill: #fefce8; stroke: #a16207; stroke-width: 2.2; rx: 14; ry: 14; }
      .region { fill: none; stroke: #64748b; stroke-width: 2; stroke-dasharray: 8 6; rx: 16; ry: 16; }
      .label { font: 600 17px Arial, Helvetica, sans-serif; fill: #111827; text-anchor: middle; dominant-baseline: middle; }
      .small { font: 500 14px Arial, Helvetica, sans-serif; fill: #1f2937; text-anchor: middle; dominant-baseline: middle; }
      .line { stroke: #334155; stroke-width: 2.4; fill: none; marker-end: url(#arrow); }
      .note { font: 500 14px Arial, Helvetica, sans-serif; fill: #475569; }
    </style>
  </defs>

  <text x="1150" y="44" class="title" text-anchor="middle">Intermediate Design 5: Planet-Scale Architecture for Billion-User Navigation</text>

  <rect class="svc" x="60" y="110" width="260" height="100" />
  <text class="label" x="190" y="160">iOS / Android / Web / Car</text>

  <rect class="ext" x="60" y="250" width="260" height="100" />
  <text class="label" x="190" y="300">On-Device Offline Engine</text>

  <rect class="svc" x="390" y="110" width="270" height="100" />
  <text class="label" x="525" y="160">Anycast DNS + WAF</text>

  <rect class="svc" x="740" y="110" width="260" height="100" />
  <text class="label" x="870" y="160">Edge API Layer</text>

  <rect class="bus" x="1080" y="110" width="280" height="100" />
  <text class="label" x="1220" y="160">CDN (Tiles/Voice/Pack)</text>

  <rect class="region" x="340" y="290" width="1860" height="580" />
  <text class="label" x="1270" y="320">Active-Active Regional Navigation Cells (Template Repeated per Region)</text>

  <rect class="svc" x="390" y="360" width="250" height="100" />
  <text class="small" x="515" y="410">Route Orchestrator</text>

  <rect class="svc" x="690" y="360" width="300" height="100" />
  <text class="small" x="840" y="410">Hierarchical Routing Engine</text>

  <rect class="svc" x="1040" y="360" width="230" height="100" />
  <text class="small" x="1155" y="410">Search Service</text>

  <rect class="svc" x="1310" y="360" width="260" height="100" />
  <text class="small" x="1440" y="410">Session Manager</text>

  <rect class="svc" x="1610" y="360" width="250" height="100" />
  <text class="small" x="1735" y="410">Maneuver + Voice Svc</text>

  <rect class="svc" x="1900" y="360" width="250" height="100" />
  <text class="small" x="2025" y="410">Traffic Query API</text>

  <rect class="db" x="430" y="530" width="240" height="100" />
  <text class="small" x="550" y="580">Road Graph Shards</text>

  <rect class="bus" x="710" y="530" width="240" height="100" />
  <text class="small" x="830" y="580">Hot Traffic Cache</text>

  <rect class="db" x="990" y="530" width="240" height="100" />
  <text class="small" x="1110" y="580">POI / Geocode Index</text>

  <rect class="db" x="1270" y="530" width="240" height="100" />
  <text class="small" x="1390" y="580">Session + Route Store</text>

  <rect class="db" x="1550" y="530" width="240" height="100" />
  <text class="small" x="1670" y="580">User Profile Store</text>

  <rect class="bus" x="1830" y="530" width="320" height="100" />
  <text class="small" x="1990" y="580">Regional Event Bus</text>

  <rect class="ext" x="390" y="700" width="240" height="100" />
  <text class="small" x="510" y="750">Probe Telemetry</text>

  <rect class="ext" x="680" y="700" width="240" height="100" />
  <text class="small" x="800" y="750">Partner Feeds</text>

  <rect class="ext" x="970" y="700" width="240" height="100" />
  <text class="small" x="1090" y="750">Crowd Incidents</text>

  <rect class="svc" x="1260" y="700" width="280" height="100" />
  <text class="small" x="1400" y="750">Stream Processing + Trust</text>

  <rect class="db" x="1590" y="700" width="280" height="100" />
  <text class="small" x="1730" y="750">Historical Traffic Lake</text>

  <rect class="ops" x="1920" y="700" width="250" height="100" />
  <text class="small" x="2045" y="750">DLQ + Replay</text>

  <rect class="ops" x="390" y="940" width="1760" height="330" />
  <text class="label" x="1270" y="972">Global Control Plane</text>

  <rect class="ops" x="450" y="1020" width="260" height="100" />
  <text class="small" x="580" y="1070">Map Build + Validation</text>

  <rect class="ops" x="760" y="1020" width="260" height="100" />
  <text class="small" x="890" y="1070">ETA Model Training</text>

  <rect class="ops" x="1070" y="1020" width="260" height="100" />
  <text class="small" x="1200" y="1070">Global Config Rollout</text>

  <rect class="ops" x="1380" y="1020" width="260" height="100" />
  <text class="small" x="1510" y="1070">Region Replication</text>

  <rect class="ops" x="1690" y="1020" width="260" height="100" />
  <text class="small" x="1820" y="1070">SLO + Canary Controller</text>

  <rect class="ops" x="920" y="1140" width="700" height="100" />
  <text class="small" x="1270" y="1190">Map/Model version contracts + rollback guarantees</text>

  <line class="line" x1="320" y1="160" x2="390" y2="160" />
  <line class="line" x1="660" y1="160" x2="740" y2="160" />
  <line class="line" x1="1000" y1="160" x2="1080" y2="160" />

  <line class="line" x1="870" y1="210" x2="515" y2="360" />
  <line class="line" x1="870" y1="210" x2="840" y2="360" />
  <line class="line" x1="870" y1="210" x2="1155" y2="360" />
  <line class="line" x1="870" y1="210" x2="1440" y2="360" />

  <line class="line" x1="640" y1="410" x2="690" y2="410" />
  <line class="line" x1="990" y1="410" x2="1040" y2="410" />
  <line class="line" x1="1270" y1="410" x2="1310" y2="410" />
  <line class="line" x1="1570" y1="410" x2="1610" y2="410" />
  <line class="line" x1="1860" y1="410" x2="1900" y2="410" />

  <line class="line" x1="840" y1="460" x2="550" y2="530" />
  <line class="line" x1="840" y1="460" x2="830" y2="530" />
  <line class="line" x1="1155" y1="460" x2="1110" y2="530" />
  <line class="line" x1="1440" y1="460" x2="1390" y2="530" />
  <line class="line" x1="1440" y1="460" x2="1670" y2="530" />
  <line class="line" x1="2025" y1="460" x2="1990" y2="530" />

  <line class="line" x1="510" y1="700" x2="1400" y2="750" />
  <line class="line" x1="800" y1="700" x2="1400" y2="750" />
  <line class="line" x1="1090" y1="700" x2="1400" y2="750" />

  <line class="line" x1="1540" y1="750" x2="830" y2="630" />
  <line class="line" x1="1540" y1="750" x2="1990" y2="580" />
  <line class="line" x1="1540" y1="750" x2="1730" y2="700" />
  <line class="line" x1="1540" y1="750" x2="2045" y2="700" />

  <line class="line" x1="580" y1="1120" x2="550" y2="630" />
  <line class="line" x1="890" y1="1120" x2="830" y2="630" />
  <line class="line" x1="1200" y1="1120" x2="1110" y2="630" />
  <line class="line" x1="1510" y1="1120" x2="1390" y2="630" />
  <line class="line" x1="1820" y1="1120" x2="1990" y2="630" />

  <line class="line" x1="1220" y1="210" x2="190" y2="250" />
  <line class="line" x1="190" y1="250" x2="1220" y2="210" />

  <text class="note" x="1390" y="246">tiles and static guidance offloaded to CDN</text>
  <text class="note" x="640" y="870">regional cell template scales horizontally as user base grows</text>
  <text class="note" x="1120" y="1328">global control plane ensures safe, versioned rollouts to every region</text>
</svg>
